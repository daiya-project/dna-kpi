---
description: Time/date terms and implementation rules when using Supabase/PostgreSQL (ads_data_daily, public_holidays). Today/current month use system date.
alwaysApply: true
---

# Data: Time and Date

Rules for time/date terms and implementation when using Supabase/PostgreSQL with tables like `ads_data_daily`, `public_holidays`.

## 1. Term definitions

| Term                        | Meaning                    | Implementation                                                                     |
| --------------------------- | -------------------------- | ---------------------------------------------------------------------------------- |
| **Date**                    | Table `date` column value  | Table's `date` (or `revenue_date`)                                                 |
| **Today / most recent day** | Current calendar day       | Use **system date** (e.g. `new Date()`, `new Date().toISOString().slice(0, 10)`)   |
| **Current month**           | Current calendar month     | Derive from **system date** (YYYY-MM)                                               |
| **Workday**                 | Non-holiday day            | Not in `public_holidays`; filter with `is_holiday = false` for daily data           |

## 2. Today / current month

- **Today**: Use the **system date** (client or server current date).
- **Current month**: The month (YYYY-MM) of the system date.

```typescript
// ✅ GOOD — system date for today / current month
const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
const currentMonth = today.slice(0, 7); // YYYY-MM
```

## 3. Workdays

- **Daily data**: Filter with `is_holiday = false` (or equivalent).
- **Check if a date is workday**: If it is **not** in `public_holidays`, treat as workday.

```typescript
// ✅ Workdays only
const { data } = await supabase
  .from("ads_data_daily")
  .select("*")
  .gte("date", startDate)
  .lte("date", endDate)
  .eq("is_holiday", false)
  .order("date", { ascending: true });

// ✅ Is workday?
const { data } = await supabase
  .from("public_holidays")
  .select("date")
  .eq("date", targetDate)
  .maybeSingle();
const isWorkday = data == null;
```

## 4. Date format (CSV / API)

- **Internal / API**: Prefer `YYYY-MM-DD`.
- **CSV / user input**: If you accept multiple formats, **normalize to YYYY-MM-DD** before DB or business logic.

## 5. Reference tables

| Table             | Role                                           |
| ----------------- | ---------------------------------------------- |
| `ads_data_daily`  | Daily data; `date`, `is_holiday`, etc.         |
| `public_holidays` | Holiday list — used for workday checks         |

## Checklist

- [ ] Today/current month use system date?
- [ ] Workday filter uses `is_holiday` or `public_holidays`?
- [ ] CSV/input dates normalized to YYYY-MM-DD before use?
