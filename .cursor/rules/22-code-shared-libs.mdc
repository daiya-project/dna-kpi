---
description: Prefer project-internal shared components and lib modules; use only the listed core external libraries. Do not introduce alternatives.
globs: "**/*.{ts,tsx}"
---

# Shared Components and Libs (Prefer When Coding)

When implementing features, **prefer the project’s shared components and internal lib modules** below. Do not reimplement the same behavior inline (e.g. number formatting, date/quarter helpers, className merging). **Use only the core external libraries** listed in this rule; do not add or suggest competing libraries.

## 0. Core External Libraries (Use Only These — Do Not Introduce Alternatives)

These are the project’s chosen stack. **Strong recommendation:** use them for the stated purpose. Do **not** introduce other libraries that overlap (e.g. no Redux/MobX/Jotai if Zustand is used for state).

| Purpose | Library | Use for |
|---------|---------|--------|
| **Framework** | Next.js, React | App Router, Server/Client Components, routing, rendering. |
| **Styling** | Tailwind CSS | Layout, spacing, typography, colors. Use utility classes; avoid ad‑hoc CSS. |
| **UI primitives** | Shadcn/ui (Radix UI + Tailwind) | Buttons, tables, toggles, tabs, dialogs, etc. Add via `npx shadcn@latest add <component>`. |
| **Icons** | `lucide-react` | All icon needs. Do not add other icon libraries. |
| **Animation** | `framer-motion` | Enter/exit, layout, and gesture animations. Do not add other animation libs for the same use. |
| **Backend / Data** | `@supabase/supabase-js`, `@supabase/ssr` | Database, auth, server/client Supabase clients. Do not add other BaaS or ORMs for the same scope. |
| **State management** | Zustand | Global/client state. Do not use Redux, MobX, Jotai, or similar. |
| **ClassName utilities** | `clsx`, `tailwind-merge` | Used inside `@/lib/utils` (cn). Prefer `cn` from `@/lib/utils` in app code. |

All generated code must use only these technologies. See `00-project-main.mdc` for full tech stack context.

## 1. Shared UI Components

| Where | Path | Use for |
|-------|------|--------|
| **Common** | `@/components/common/PageSkeleton` | Full-page loading skeleton (e.g. Suspense fallback). |
| **UI (Shadcn)** | `@/components/ui/button` | Buttons. |
| | `@/components/ui/skeleton` | Skeleton placeholders. |
| | `@/components/ui/table` | Table, TableHead, TableRow, TableCell, TableBody. |
| | `@/components/ui/toggle-group` | ToggleGroup, ToggleGroupItem. |
| | `@/components/ui/progress` | Progress bar. |
| | `@/components/ui/tabs` | Tabs. |
| | `@/components/ui/dialog` | Dialog (modals). |
| | `@/components/ui/input` | Text/numeric input. |
| | `@/components/ui/checkbox` | Checkbox. |

Add new Shadcn components via `npx shadcn@latest add <component>`; do not copy-paste from external sources.

## 2. Internal Lib Modules (Prefer Over Inline Logic)

| Path | Use for |
|------|--------|
| **`@/lib/utils`** | `cn` — className merging (use in all UI components). |
| **`@/lib/number-utils`** | Number/percentage display: `formatNumber`, `formatPercent`, `formatNumberOrFallback`, `percentRate`, `parseNumber`. Use when rendering KPI values, rates, or any numeric cell. |
| **`@/lib/date-utils`** | Dates and quarters: `getToday`, `getCurrentMonth`, `getYearFromMonth`, `getYearsFromMonthStrings`, `getMonthsForYear`, `toYearMonth`, etc. Use for date handling and quarter logic (e.g. KPI table columns). |
| **`@/lib/string-utils`** | String helpers: `trim`, `truncate`, `capitalizeWords`, `isBlank`. **Number display/parse for inputs:** `formatWithThousandSeparator(value)` (e.g. 1234567 → "1,234,567"), `stripThousandSeparator(value)` (remove commas before parsing or sending to DB/API). Use for modal inputs that show comma-separated numbers. |
| **`@/lib/config/categories`** | Category config (ids, labels, colors) for bars, cards, filters. |
| **`@/lib/config/dashboard-sections`** | Dashboard section/tab config (section ids, titles, colors). |
| **`@/lib/logic/kpi-table-data`** | Building table sections, display columns, monthly/quarterly data. |
| **`@/lib/logic/kpi-card`** | YTD summary by category (e.g. summary cards). |
| **`@/lib/supabase/server`** | Server-side Supabase client. |
| **`@/lib/supabase/client`** | Client-side Supabase client. |
| **`@/lib/api/*`** | Data fetching (e.g. `lib/api/kpi` for KPI). |
| **`@/hooks/*`** | Shared hooks (e.g. `useKpiTableCollapse`). |
| **`@/stores/*`** | Zustand stores (e.g. `dashboardFilterStore`). |

## 3. Examples

```ts
// ✅ GOOD — number/percentage from shared lib
import { formatNumber, formatPercent } from "@/lib/number-utils";
// Use formatNumber(value), formatPercent(rate) in table cells or cards.
```

```ts
// ✅ GOOD — date/quarter from shared lib
import { getYearFromMonth, getMonthsForYear, getYearsFromMonthStrings } from "@/lib/date-utils";
// Use for column headers, year navigator, quarter grouping.
```

```ts
// ✅ GOOD — className via cn
import { cn } from "@/lib/utils";
<div className={cn("base", isActive && "active")} />
```

```ts
// ✅ GOOD — thousand separator for input display / strip before DB
import { formatWithThousandSeparator, stripThousandSeparator } from "@/lib/string-utils";
// Display: formatWithThousandSeparator(num). Parse: parseNumber(stripThousandSeparator(raw)).
```

```ts
// ❌ BAD — inline number formatting
const s = Number.isNaN(n) ? "—" : n.toLocaleString(); // use @/lib/number-utils instead
```

## 4. Checklist

- [ ] Only core external libs used (Next.js, React, Tailwind, Shadcn, lucide-react, framer-motion, Supabase, Zustand)? No competing libraries added?
- [ ] Number/percentage display uses `@/lib/number-utils`?
- [ ] Date/quarter logic uses `@/lib/date-utils`?
- [ ] UI uses `@/components/ui/*` or `@/components/common/*` where applicable?
- [ ] className merging uses `cn` from `@/lib/utils`?
- [ ] Input display/parse with thousand separators uses `@/lib/string-utils` (`formatWithThousandSeparator`, `stripThousandSeparator`)?
