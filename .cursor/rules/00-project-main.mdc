---
description: Main project rules and conventions for dna-kpi
alwaysApply: true
---

# Project Main Rules

## Rule Language

**All rules in this project are written in English.**  
When adding or editing files under `.cursor/rules/`, write rule content in English so that AI guidance and project conventions stay consistent and language-agnostic.

## Scope

This file defines the project's core, baseline expectations. Other rule files may add file-specific or topic-specific conventions on top of these.

## Tech Stack Context

- **Framework:** Next.js 16 (App Router, React 19).
- **Backend / Data:** Supabase (`@supabase/supabase-js` + `@supabase/ssr`).
- **Styling:** Tailwind CSS v4.
- **UI components:** Shadcn/ui (Radix UI primitives + Tailwind; install via `npx shadcn@latest add <component>`; do not copy-paste from external sources—use the project's existing `components.json` and `components/ui/`).
- **State management:** Zustand. Keep stores in the `stores/` directory (one store per file). Use `devtools` middleware in development. Do **not** use Redux, MobX, Jotai, or other state libraries.
- **All generated code must use only these technologies.** Prefer Next.js patterns (Server Components, Server Actions where appropriate) and the project's Shadcn/ui components; do not introduce other UI libraries or frameworks.

## Project Structure

```
app/                  # Next.js App Router (layouts, pages, route handlers)
  globals.css         # Global styles (Tailwind directives, CSS variables)
components/
  ui/                 # Shadcn/ui components (add via npx shadcn@latest add)
  common/             # Shared reusable UI components
hooks/                # Custom React hooks
stores/               # Zustand stores (one store per file)
lib/
  api/                # API / data communication layer only
  supabase/           # Supabase client (client.ts, server.ts, middleware.ts)
  utils/              # Shared utilities (barrel export via index.ts)
  utils.ts            # Legacy re-export for Shadcn compatibility
types/                # Global type definitions
  database.types.ts   # Supabase auto-generated (npm run update-types)
  app-db.types.ts     # App-level re-exports of used tables/views
docs/                 # Product and technical documentation
  products/           # Component docs (per 24-code-component-docs); one .md per component
planning/             # Planning documents before new components, functions, state, folders
public/               # Static assets
middleware.ts         # Next.js middleware (Supabase session refresh)
```

## Planning Before New Artifacts

**MANDATORY:** When creating a **new component, function, state (store), or folder**, **do not create it immediately.** Creating such artifacts without a prior planning document is **not allowed.**

1. **Write a planning document first.** Before creating any new component file, function, state, or folder, you **must** add a planning document under the **`planning/`** folder that includes:
   - **Folder and path:** Where the artifact will live (e.g. `components/common/`, `app/(dashboard)/dashboard/_components/`, `lib/utils/`, `stores/`), consistent with existing structure and naming.
   - **Type and purpose:** What is being added (component / function / state store / folder) and its purpose.
   - **For components:** **Server vs Client** (Server Component by default; Client only if it uses hooks, event handlers, or browser APIs); **reuse of existing libraries** (e.g. Shadcn/ui, existing `Button` from `components/ui/`). Prefer reusing existing UI over introducing new patterns.
   - **For functions:** Target path (e.g. `lib/`, `lib/api/`), responsibility, and suggested signature or API.
   - **For state:** Store name, path under `stores/`, and what state it holds.
   - **For folders:** Purpose and intended contents.
2. **Wait for confirmation.** Share the planning document with the user and ask for confirmation (or adjustments).
3. **Create only after confirmation.** Implement the artifact **only** after the user explicitly confirms the planning document (or an updated version).

**Also consider writing a planning document (and getting user confirmation) for:**

- **New npm dependencies** — bundle size, licenses, and long-term maintenance.
- **New environment variables or config files** — deployment and security impact.
- **New API routes or Server Actions** — entry points, auth, and security.
- **New app route segments (URLs)** — navigation, SEO, and existing links.
- **Database or type schema changes** — migrations, data loss risk, and downtime.

In each case, document impact and placement in `planning/` and get user confirmation before implementing.

## Workflow and Roadmap

- **Always check `@.cursor/rules/02-project-roadmap.mdc`** before starting any task to understand the current phase and context.
- **Update the roadmap**: When a task is completed, mark it as checked (`[x]`) in `02-project-roadmap.mdc` and suggest the next step from the list.

## Communication and Documentation Language

- **Feedback to the user**: When providing feedback, explanations, or responses directed at the user, use **Korean**.
- **Markdown documents**: When creating or editing Markdown (`.md`) documents in the project—excluding rule files under `.cursor/rules/`—write the document content in **Korean**.
